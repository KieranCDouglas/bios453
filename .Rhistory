rename(
paradrug = m60_1,
insured = v481,
sizechild = m18_1,
bwkg = m19_1,
csect = m17_1,
anemia = v457,
delivplace = m15_1,
termpreg = v228,
bpast5 = v208,
wind_urbrur = v190a,
wind = v190,
educ = v149,
ethnic = v131,
state = v024,
smokes = v463aa,
married = v501,
age = v447a,
) %>%
filter(
paradrug!=8,
paradrug!=9,
bwkg <5501,
bwkg > 249,
bwkg != 9996,
bwkg != 9998,
bwkg != 9999,
sizechild!=8,
insured != 9,
sizechild != 9,
csect != 9,
anemia != 9,
termpreg != 9,
educ != 9,
smokes != 9,
married != 9,
age != 99,
) %>%
mutate(
paradrug = as.factor(paradrug),
insured = as.factor(insured),
sizechild = factor(sizechild,
levels = c("very large" = "1",
"larger than average" = "2",
"average" = "3",
"smaller than average" = "4",
"very small" = "5")),
csect = factor(csect),
anemia = factor(anemia,
levels = c("severe" = "1",
"moderate" = "2",
"mild" = "3",
"not anemic" = "4")),
delivplace = factor(delivplace),
termpreg = factor(termpreg),
bpast5 = factor(bpast5),
wind = factor(wind,
levels = c("poorest" = "1",
"poorer" = "2",
"middle" = "3",
"richer" = "4",
"richest" = "5")),
educ = factor(educ,
levels = c("none" = "0",
"incomplete primary" = "1",
"complete primary" = "2",
"incomplete secondary" = "3",
"complete secondary" = "4",
"higher" = "5")),
ethnic = factor(ethnic,
levels = c("caste" = "991",
"tribe" = "992",
"no caste/tribe" = "993",
"dont know" = "998")),
smokes = factor(smokes)
)
knitr::opts_chunk$set(echo = TRUE)
options(repos = c(CRAN = "https://cloud.r-project.org"))
dhs_clean <- dhs %>%
select(m60_1, v481, m18_1, m19_1, m17_1, v457, m15_1, v228, v208, v190a, v190, v149, v131, v024, v463aa, v501, v447a) %>%
rename(
paradrug = m60_1,
insured = v481,
sizechild = m18_1,
bwkg = m19_1,
csect = m17_1,
anemia = v457,
delivplace = m15_1,
termpreg = v228,
bpast5 = v208,
wind_urbrur = v190a,
wind = v190,
educ = v149,
ethnic = v131,
state = v024,
smokes = v463aa,
married = v501,
age = v447a,
) %>%
filter(
paradrug!=8,
paradrug!=9,
bwkg <5501,
bwkg > 249,
bwkg != 9996,
bwkg != 9998,
bwkg != 9999,
sizechild!=8,
insured != 9,
sizechild != 9,
csect != 9,
anemia != 9,
termpreg != 9,
educ != 9,
smokes != 9,
married != 9,
age != 99,
) %>%
mutate(
paradrug = as.factor(paradrug),
insured = as.factor(insured),
sizechild = factor(sizechild,
levels = c("very large" = "1",
"larger than average" = "2",
"average" = "3",
"smaller than average" = "4",
"very small" = "5")),
csect = factor(csect),
anemia = factor(anemia,
levels = c("severe" = "1",
"moderate" = "2",
"mild" = "3",
"not anemic" = "4")),
delivplace = factor(delivplace),
termpreg = factor(termpreg),
bpast5 = factor(bpast5),
wind = factor(wind,
levels = c("poorest" = "1",
"poorer" = "2",
"middle" = "3",
"richer" = "4",
"richest" = "5")),
educ = factor(educ,
levels = c("none" = "0",
"incomplete primary" = "1",
"complete primary" = "2",
"incomplete secondary" = "3",
"complete secondary" = "4",
"higher" = "5")),
ethnic = factor(ethnic,
levels = c("caste" = "991",
"tribe" = "992",
"no caste/tribe" = "993",
"dont know" = "998")),
smokes = factor(smokes)
)
library(tidyverse)
library(gt)
library(tinytex)
library(naniar)
library(ggthemes)
library(glmnet)
dhs <- read_csv("~/Documents/GitHub/bios/453/bios453/IAIR7EFL.csv")
dhs_clean <- dhs %>%
select(m60_1, v481, m18_1, m19_1, m17_1, v457, m15_1, v228, v208, v190a, v190, v149, v131, v024, v463aa, v501, v447a) %>%
rename(
paradrug = m60_1,
insured = v481,
sizechild = m18_1,
bwkg = m19_1,
csect = m17_1,
anemia = v457,
delivplace = m15_1,
termpreg = v228,
bpast5 = v208,
wind_urbrur = v190a,
wind = v190,
educ = v149,
ethnic = v131,
state = v024,
smokes = v463aa,
married = v501,
age = v447a,
) %>%
filter(
paradrug!=8,
paradrug!=9,
bwkg <5501,
bwkg > 249,
bwkg != 9996,
bwkg != 9998,
bwkg != 9999,
sizechild!=8,
insured != 9,
sizechild != 9,
csect != 9,
anemia != 9,
termpreg != 9,
educ != 9,
smokes != 9,
married != 9,
age != 99,
) %>%
mutate(
paradrug = as.factor(paradrug),
insured = as.factor(insured),
sizechild = factor(sizechild,
levels = c("very large" = "1",
"larger than average" = "2",
"average" = "3",
"smaller than average" = "4",
"very small" = "5")),
csect = factor(csect),
anemia = factor(anemia,
levels = c("severe" = "1",
"moderate" = "2",
"mild" = "3",
"not anemic" = "4")),
delivplace = factor(delivplace),
termpreg = factor(termpreg),
bpast5 = factor(bpast5),
wind = factor(wind,
levels = c("poorest" = "1",
"poorer" = "2",
"middle" = "3",
"richer" = "4",
"richest" = "5")),
educ = factor(educ,
levels = c("none" = "0",
"incomplete primary" = "1",
"complete primary" = "2",
"incomplete secondary" = "3",
"complete secondary" = "4",
"higher" = "5")),
ethnic = factor(ethnic,
levels = c("caste" = "991",
"tribe" = "992",
"no caste/tribe" = "993",
"dont know" = "998")),
smokes = factor(smokes)
)
miss_var_summary(dhs_clean) %>%
arrange(desc(pct_miss))
library(dplyr)
library(tidyr)
library(gt)
# categorical summary
cat_summary <- dhs_clean %>%
select(paradrug, insured, educ) %>%
pivot_longer(everything(), names_to = "variable", values_to = "category") %>%
group_by(variable) %>%
mutate(total = n()) %>%
group_by(variable, category) %>%
summarise(
count = n(),
percent = paste0(round(100 * count / first(total), 1), "%"),
.groups = "drop"
) %>%
arrange(variable, category) %>%
group_by(variable) %>%
mutate(row_id = row_number()) %>%
ungroup()
# summary for numerical variables
num_summary <- dhs_clean %>%
summarise(across(c(age, bwkg),
list(mean = ~round(mean(., na.rm = TRUE), 2),
median = ~round(median(., na.rm = TRUE), 2),
sd = ~round(sd(., na.rm = TRUE), 2)),
.names = "{.col}_{.fn}")) %>%
pivot_longer(everything(), names_to = c("variable", "statistic"), names_sep = "_") %>%
pivot_wider(names_from = statistic, values_from = value) %>%
mutate(row_id = 1)
# merge and gt table
bind_rows(
cat_summary,
num_summary %>% mutate(category = NA, count = NA, percent = NA)
) %>%
arrange(factor(variable, levels = c("paradrug", "insured", "educ", "age", "bwkg"))) %>%
gt(groupname_col = "variable") %>%
tab_header(
title = "Summary Statistics for DHS Dataset",
) %>%
cols_label(
category = "Category",
count = "Count",
percent = "Percentage",
mean = "Mean",
median = "Median",
sd = "Std Dev"
) %>%
fmt_number(
columns = c(mean, median, sd),
decimals = 2
) %>%
cols_align(
align = "center",
columns = c(category, count, percent, mean, median, sd)
) %>%
tab_style(
style = cell_text(weight = "bold"),
locations = cells_column_labels()
) %>%
tab_style(
style = cell_fill(color = "#C5DECD"),
locations = cells_body(
rows = variable %in% c("paradrug", "insured", "educ")
)
) %>%
fmt_missing(columns = everything(), missing_text = "-") %>%
cols_hide(columns = c(row_id))%>%
tab_options(table.background.color = "#F1F7ED")
## Using LASSO
y=dhs_clean$bwkg
x=as.matrix(dhs_clean[,-1])
fit=cv.glmnet(x=x,y=y,alpha=1,nfolds = 5)
plot(fit)
#lambda with smallest MSE
fit$lambda.min
#lambda with 1 SE above the lambda with smallest MSE
fit$lambda.1se
#find optimal lambda value that minimizes test MSE
best_lambda=fit$lambda.min
best_lambda
#extract coefficients for a lambda equal to best lambda
c=coef(fit,s = best_lambda)
#print outcoefficients not equal to 0
inds=which(c!=0)
c[inds,]
## Using LASSO
y=dhs_clean$bwkg
x=as.matrix(dhs_clean[,-1])
fit=cv.glmnet(x=x,y=y,alpha=1,nfolds = 5)
plot(fit)
#lambda with smallest MSE
fit$lambda.min
#lambda with 1 SE above the lambda with smallest MSE
fit$lambda.1se
#find optimal lambda value that minimizes test MSE
best_lambda=fit$lambda.min
best_lambda
#extract coefficients for a lambda equal to best lambda
c=coef(fit,s = best_lambda)
#print outcoefficients not equal to 0
inds=which(c!=0)
c[inds,]
knitr::opts_chunk$set(echo = FALSE, message=FALSE,warning=FALSE)
#import data and then manage the data a bit
library(readr) #package for importing data into R
library(tidyverse)
library(olsrr) #package for variable selection
library(glmnet) #package for LASSO
library(knitr) #package for generating tables
library(haven)
library(gtsummary)
library(knitr)
library(caret)
library(pROC)
library(MASS)
IAIR7EFL <- read_csv("IAIR7EFL.csv")
knitr::opts_chunk$set(echo = FALSE, message=FALSE,warning=FALSE)
#import data and then manage the data a bit
library(readr) #package for importing data into R
library(tidyverse)
library(olsrr) #package for variable selection
library(glmnet) #package for LASSO
library(knitr) #package for generating tables
library(haven)
library(gtsummary)
library(knitr)
library(caret)
library(pROC)
library(MASS)
dhs=read_csv("IAIR7EFL.csv")
#View(dhs)
#generate a subset of the data
dhs.s=subset(dhs,select=c(v012,v155,v171a,v201,v437,v438,v445))
rm(dhs) #delete dhs data frame from memory
#relabel variables
dhs.s$age=dhs.s$v012
dhs.s$older=(dhs.s$age>30)+0
dhs.s$older=factor(dhs.s$older,levels=c(0,1),labels = c("<=30 yo","> 30 yo"))
dhs.s$literacy=dhs.s$v155
#level needs to match the data
dhs.s$literacy=factor(dhs.s$literacy,
levels=seq(0,4),
labels=c("Cannot read at all",
"Able to read only parts of sentence",
"Able to read whole sentence",
"No card with required language",
"Blind/visually impaired"))
dhs.s$internet.use=(dhs.s$v171a==3)+0
dhs.s$children.born=dhs.s$v201
dhs.s$wt.kg=dhs.s$v437/10
#code missing/unknown as NA
dhs.s$wt.kg[dhs.s$v437>2000]=NA
dhs.s$ht.m=dhs.s$v438/1000
dhs.s$ht.m[dhs.s$v438>2500]=NA
dhs.s$bmi=dhs.s$v445/100
dhs.s$bmi[dhs.s$v445>6000]=NA
#dataset for variable selection: need to remove missing data in order to perform LASSO
dhs.ss=na.omit(subset(dhs.s,select=c(bmi,age,literacy,internet.use,children.born)))
model=lm(bmi ~age+literacy+internet.use+children.born, data = dhs.ss)
ols_step_all_possible(model)
ols_step_best_subset(model)
ols_step_forward_p(model)
ols_step_backward_p(model)
ols_step_both_p(model)
k=ols_step_forward_adj_r2(model)
plot(k)
y=dhs.ss$bmi
x=as.matrix(dhs.ss[,-1])
fit=cv.glmnet(x=x,y=y,alpha=1,nfolds = 5)
plot(fit)
#lambda with smallest MSE
fit$lambda.min
#lambda with 1 SE above the lambda with smallest MSE
fit$lambda.1se
#find optimal lambda value that minimizes test MSE
best_lambda=fit$lambda.min
best_lambda
#extract coefficients for a lambda equal to best lambda
c=coef(fit,s = best_lambda)
#print outcoefficients not equal to 0
inds=which(c!=0)
c[inds,]
model=lm(bwkg ~paradrug+insured+csect+anemia+delivplace+termpreg+bpast5+wind_urbrur+wind+educ+ethnic+state+smokes+married+age, data = dhs_clean)
ols_step_all_possible(model)
library(tidyverse)
library(gt)
library(tinytex)
library(naniar)
library(ggthemes)
library(glmnet)
dhs <- read_csv("~/Documents/GitHub/bios/453/bios453/IAIR7EFL.csv")
dhs_clean <- dhs %>%
select(m60_1, v481, m18_1, m19_1, m17_1, v457, m15_1, v228, v208, v190a, v190, v149, v131, v024, v463aa, v501, v447a) %>%
rename(
paradrug = m60_1,
insured = v481,
sizechild = m18_1,
bwkg = m19_1,
csect = m17_1,
anemia = v457,
delivplace = m15_1,
termpreg = v228,
bpast5 = v208,
wind_urbrur = v190a,
wind = v190,
educ = v149,
ethnic = v131,
state = v024,
smokes = v463aa,
married = v501,
age = v447a,
) %>%
filter(
paradrug!=8,
paradrug!=9,
bwkg <5501,
bwkg > 249,
bwkg != 9996,
bwkg != 9998,
bwkg != 9999,
sizechild!=8,
insured != 9,
sizechild != 9,
csect != 9,
anemia != 9,
termpreg != 9,
educ != 9,
smokes != 9,
married != 9,
age != 99,
) %>%
mutate(
paradrug = as.factor(paradrug),
insured = as.factor(insured),
sizechild = factor(sizechild,
levels = c("very large" = "1",
"larger than average" = "2",
"average" = "3",
"smaller than average" = "4",
"very small" = "5")),
csect = factor(csect),
anemia = factor(anemia,
levels = c("severe" = "1",
"moderate" = "2",
"mild" = "3",
"not anemic" = "4")),
delivplace = factor(delivplace),
termpreg = factor(termpreg),
bpast5 = factor(bpast5),
wind = factor(wind,
levels = c("poorest" = "1",
"poorer" = "2",
"middle" = "3",
"richer" = "4",
"richest" = "5")),
educ = factor(educ,
levels = c("none" = "0",
"incomplete primary" = "1",
"complete primary" = "2",
"incomplete secondary" = "3",
"complete secondary" = "4",
"higher" = "5")),
ethnic = factor(ethnic,
levels = c("caste" = "991",
"tribe" = "992",
"no caste/tribe" = "993",
"dont know" = "998")),
smokes = factor(smokes)
)
